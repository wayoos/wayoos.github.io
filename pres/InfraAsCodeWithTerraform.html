---
layout: slides
title: Infrastructure as code with Terraform
theme: white
---

<section>
        <h2>Infrastructure as code with Terraform</h2>
        <p>
            <small>Created by <a href="https://github.com/quidio">Stéphane Cusin</a></small>
        </p>
    </section>


    <section>
        <img data-src="{{ "/pres/images/FirstVPS.png" | prepend: site.baseurl }}">
        <p>My first VPS Server</p>            
        <aside class="notes">
                Start by the story, first VPS
        </aside>
    </section> 

    <section>
        <img data-src="{{ "/pres/images/FirstVPS.png" | prepend: site.baseurl }}">
        <p>What append when I should change infrastructure ?</p>
        <aside class="notes">
            Explain that all command was traced in a txt file.
            This faile was a pseudo bash script
        </aside>
    </section> 
    
    <section>
            <img data-src="{{ "/pres/images/VPSMove.png" | prepend: site.baseurl }}">
            <p>Move to another provider</p>  
    </section> 

    <section>
            <img data-src="{{ "/pres/images/Capistrano.png" | prepend: site.baseurl }}">
            <p>Ok, I don't will do it again</p>  
    </section> 

    <section>
        <h2></h2>
        <p>
            Provisioning servers with ansible, but all infrastructure was made by hand.
        </p>
        <aside class="notes">
            Explain that all infrastructure change like DNS, Server was manipulated with UI.
        </aside>
    </section>

    <section>
            <img data-src="{{ "/pres/images/Ansible.png" | prepend: site.baseurl }}">
            <p>Provisioning with ansible</p>  
    </section>

    <section>
        <h2></h2>
        <p>
            Today, how to deploy a new project.
        </p>
        <aside class="notes">

        </aside>
    </section>

    <section>
            <img height="75%" width="75%" data-src="{{ "/pres/images/aws_services.png" | prepend: site.baseurl }}">
            <p>We can use AWS</p>
    </section>

    <section>
            <img data-src="{{ "/pres/images/Google-cloud-plateforme2.png" | prepend: site.baseurl }}">
            <p>Or Google Cloud Platform</p>
    </section>

    <section>
            <img data-src="{{ "/pres/images/IAAS1.png" | prepend: site.baseurl }}">
            <p>You probably want more than one server</p>  
    </section> 

    <section>
            <h2></h2>
            <p>
                ok but infrastructure is not only server
            </p>
            <aside class="notes">
                Explain that infrastructure is network, computing, storage, etc.
                AWS as 1200 api
            </aside>
    </section>

    <section>
            <img data-src="{{ "/pres/images/IAAS2.png" | prepend: site.baseurl }}">
            <p>Add a load balancer</p>
    </section>

    <section>
            <img data-src="{{ "/pres/images/IAAS3.png" | prepend: site.baseurl }}">
            <p>And Volumes, databases and S3 to store all data</p>
    </section>

    <section>
            <img height="95%" width="95%" style="margin-bottom: 0px" data-src="{{ "/pres/images/IAAS4.png" | prepend: site.baseurl }}">
            <p style="margin-top: 0px">Don't forget the VPC, subnets, route tables, Nat gateways</p>
    </section>

    <section>
            <img height="150%" width="150%" style="margin-bottom: 0px" data-src="{{ "/pres/images/iaasprod-stage.png" | prepend: site.baseurl }}">
            <p style="margin-top: 0px">And you should have that in separate environments for stage and prod</p>
    </section>


    <section style="text-align: left;">
            <p>What append if all was setup with GUI and you have to maintain it all. Forever</p>
    </section>


    <section data-background-image="https://ljdchost.com/cF0gNhP.gif">
    </section>

    <section style="text-align: left;">
            <p>In this talk, I will show you how to use infrastructure as code to deploy Kubernetes over Openstack.
            </p>
    </section>

    <section>
            <p>In just a few simple commands</p>
            
            <pre><code class="hljs" data-trim contenteditable>
                $ wayoos-source-prod
                $ infra-compose exec up
            </code></pre>
        </section>

    <section>
        <div style="float:left;width:50%;">
            <h1 style="text-align: left; text-transform: none; color: black; margin-bottom: 0px">I'm</h1>
            <h1 style="text-align: left; text-transform: none; color: black; margin-bottom: 0px">Stéphane</h1>
            <h1 style="text-align: left; text-transform: none; color: rgb(34, 141, 190); margin-bottom: 0px">Cusin</h1>
            <p></p>
            <p></p>
            <h2 style="text-align: left; text-transform: none; color: rgb(129, 127, 123); margin-bottom: 0px">wayoos.io</h2>
        </div>
        <div style="float:right;width:50%;padding-right:0px;">
            <img data-src="https://avatars1.githubusercontent.com/u/6886021?s=460&v=4">                        
        </div>
    </section>

    <section style="text-align: left;" data-background-image="https://static.pexels.com/photos/227729/pexels-photo-227729.jpeg">
            <h2 style="color: wheat">Outline</h2>

            <h3 style="color: white; text-transform: none;">1. infrastructure-as-code</h3>
            <h3 style="color: white; text-transform: none;">2. demo</h3>
            <h3 style="color: white; text-transform: none;">3. infra-compose</h3>
    </section>

    <section style="text-align: left;" data-background-image="https://static.pexels.com/photos/227729/pexels-photo-227729.jpeg">
        <h2 style="color: wheat">Outline</h2>

        <h3 style="color: white; text-transform: none;">1. infrastructure-as-code</h3>
        <h3 style="color: grey; text-transform: none;">2. demo</h3>
        <h3 style="color: grey; text-transform: none;">3. infra-compose</h3>
    </section>

    <section style="text-align: left;">
            <h2>Outline</h2>
            <ul>
                <li>infrastructure-as-code most popular tools</li>
                <li>Mutable Infrastructure vs Immutable Infrastructure</li>
                <li>Procedural vs Declarative</li>
                <li>Client/Server Architecture vs Client-Only Architecture</li>
                <li>Demo </li>
                <li>infra-compose tool</li>
            </ul>
    </section>



    <section>
        <p>Instead of clicking around a web UI or SSHing to a server and manually executing commands, the idea behind IAC is to write code to define, provision, and manage your infrastructure.</p>
    </section>

    <section>
            <p>- Treat Infrastructure Like Application Code</p>
            <p>- Same Code for All Environments</p>
            <p>- Anyone Can Build an Environment Anytime</p>
            <p>- Validate Infrastructure Before Deployment</p>
            <p>- Always Know What Changed</p>
            <p>- Iac Will Put a Smile on Your Face</p>
            <aside class="notes">
                    https://dzone.com/articles/infrastructure-as-code-the-benefits
            </aside>
    
    </section>
        
    <section style="text-align: center; color: white;" data-background-image="https://static.pexels.com/photos/258510/pexels-photo-258510.jpeg">
        <h2 style="color: white; text-transform: none;">Ok for IAC but wich tool ?</h2>
        <ul>
            <li>Puppet (2005)</li>
            <li>Chef (2009)</li>
            <li>SaltStack (2011)</li>
            <li>CloudFormation (2011)</li>
            <li>Ansible (2012)</li>
            <li>Terraform (2014)</li>
        </ul>
    </section>


    <section>
            <p>A comparison of popular infrastructure-as-code tools.</p>
            <img data-src="https://cdn-images-1.medium.com/max/2000/1*bVC97LGrOY4R5E4WwzMLzw.png">
    </section>

    <section>
            <p>A comparison of popular infrastructure-as-code tools.</p>
            <img data-src="https://cdn-images-1.medium.com/max/2000/1*bVC97LGrOY4R5E4WwzMLzw.png">
    </section>
        
    <section>
            <p>12 factory</p>

            TODO add list
    </section>

    <section style="text-align: left;" data-background-image="https://static.pexels.com/photos/227729/pexels-photo-227729.jpeg">
        <h2 style="color: wheat">Outline</h2>

        <h3 style="color: grey; text-transform: none;">1. infrastructure-as-code</h3>
        <h3 style="color: white; text-transform: none;">2. demo</h3>
        <h3 style="color: grey; text-transform: none;">3. infra-compose</h3>
    </section>


    <section>
            <img data-src="{{ "/pres/images/demonet.png" | prepend: site.baseurl }}">
            <p>First things define network setup</p>
    </section>

    <section>
            <p>Network setup, vrack and security group</p>
            
            <pre><code class="hljs" data-trim contenteditable>
                $ infra-compose exec ovh-vrack up
                $ infra-compose exec network-up
            </code></pre>
    </section>

    <section>
            <img data-src="{{ "/pres/images/demoimage.png" | prepend: site.baseurl }}">
            <p>Control base server image</p>
    </section>

    <section>
            <p>Install server image</p>
            
            <pre><code class="hljs" data-trim contenteditable>
                $ infra-compose exec image-up
            </code></pre>
    </section>

    <section>
            <img data-src="{{ "/pres/images/demobastion.png" | prepend: site.baseurl }}">
            <p>Bastion</p>
    </section>

    <section>
            <p>Start bastion</p>
            
            <pre><code class="hljs" data-trim contenteditable>
                $ infra-compose exec bastion up
            </code></pre>
    </section>

    <section>
            <img data-src="{{ "/pres/images/demoetcd.png" | prepend: site.baseurl }}">
            <p>Etcd cluster</p>
    </section>

    <section>
            <p>Start Etcd cluster</p>
            
            <pre><code class="hljs" data-trim contenteditable>
                $ infra-compose exec etcd-new
            </code></pre>
    </section>

    <section>
            <img data-src="{{ "/pres/images/demomaster.png" | prepend: site.baseurl }}">
            <p>Kubernetes master</p>
    </section>

    <section>
            <p>Start Kubernetes master</p>
            
            <pre><code class="hljs" data-trim contenteditable>
                $ infra-compose exec kube-master up
            </code></pre>
    </section>

    <section>
            <img data-src="{{ "/pres/images/demofinal.png" | prepend: site.baseurl }}">
            <p>Final infrastructure, managed by code</p>
    </section>

    <section>
            <p>The price of this setup</p>
            <ul>
                    <li>Bastion 3€</li>
                    <li>Etcd server 3x 6€</li>
                    <li>Kube master 6€</li>
                    <li>Kube worker 24x 20€</li>
                </ul>
    
                <p>For 507€ you will have a kubernetes cluster of 2x24=48 Cores and 7Gbx24=168</p>
            
    </section>

    <section style="text-align: left;" data-background-image="https://static.pexels.com/photos/227729/pexels-photo-227729.jpeg">
        <h2 style="color: wheat">Outline</h2>

        <h3 style="color: grey; text-transform: none;">1. infrastructure-as-code</h3>
        <h3 style="color: grey; text-transform: none;">2. demo</h3>
        <h3 style="color: white; text-transform: none;">3. infra-compose</h3>
    </section>


    <section style="text-align: left;">
        <h1>Thanks</h1>
        <p>
            - <a href="http://wayoos.io">wayoos.io</a> <br>
            - <a href="https://github.com/wayoos/infra-compose">infra-compose</a>
        </p>
    </section>
